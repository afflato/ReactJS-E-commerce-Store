/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

'use strict';var n=require("lexical"),x=require("@lexical/list"),E=require("@lexical/rich-text"),aa=require("@lexical/utils"),F=require("@lexical/code"),G=require("@lexical/link");function H(a,c){let b={};for(let f of a)(a=c(f))&&(b[a]?b[a].push(f):b[a]=[f]);return b}function I(a){a=H(a,c=>c.type);return{element:a.element||[],multilineElement:a["multiline-element"]||[],textFormat:a["text-format"]||[],textMatch:a["text-match"]||[]}}let J=/[!-/:-@[-`{-~\s]/,ba=/^\s{0,3}$/;
function K(a){if(!n.$isParagraphNode(a))return!1;let c=a.getFirstChild();return null==c||1===a.getChildrenSize()&&n.$isTextNode(c)&&ba.test(c.getTextContent())}function ca(a,c=!1){let b=I(a),f=[...b.multilineElement,...b.element],d=!c,e=b.textFormat.filter(g=>1===g.format.length);return g=>{let m=[];g=(g||n.$getRoot()).getChildren();for(let k=0;k<g.length;k++){let t=g[k],y=da(t,f,e,b.textMatch);null!=y&&m.push(d&&0<k&&!K(t)&&!K(g[k-1])?"\n".concat(y):y)}return m.join("\n")}}
function da(a,c,b,f){for(let d of c)if(d.export&&(c=d.export(a,e=>L(e,b,f)),null!=c))return c;return n.$isElementNode(a)?L(a,b,f):n.$isDecoratorNode(a)?a.getTextContent():null}
function L(a,c,b){let f=[];a=a.getChildren();a:for(let d of a){for(let e of b)if(e.export&&(a=e.export(d,g=>L(g,c,b),(g,m)=>M(g,m,c)),null!=a)){f.push(a);continue a}n.$isLineBreakNode(d)?f.push("\n"):n.$isTextNode(d)?f.push(M(d,d.getTextContent(),c)):n.$isElementNode(d)?f.push(L(d,c,b)):n.$isDecoratorNode(d)&&f.push(d.getTextContent())}return f.join("")}
function M(a,c,b){let f=c.trim(),d=f,e=new Set;for(let m of b){b=m.format[0];let k=m.tag;if(O(a,b)&&!e.has(b)){e.add(b);var g=P(a,!0);O(g,b)||(d=k+d);g=P(a,!1);O(g,b)||(d+=k)}}return c.replace(f,()=>d)}
function P(a,c){let b=c?a.getPreviousSibling():a.getNextSibling();b||(a=a.getParentOrThrow(),a.isInline()&&(b=c?a.getPreviousSibling():a.getNextSibling()));for(;b;){if(n.$isElementNode(b)){if(!b.isInline())break;a=c?b.getLastDescendant():b.getFirstDescendant();if(n.$isTextNode(a))return a;b=c?b.getPreviousSibling():b.getNextSibling()}if(n.$isTextNode(b))return b;if(!n.$isElementNode(b))break}return null}function O(a,c){return n.$isTextNode(a)&&a.hasFormat(c)}
let Q="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,ea=Q&&"documentMode"in document?document.documentMode:null;Q&&"InputEvent"in window&&!ea?"getTargetRanges"in new window.InputEvent("input"):!1;
let R=Q&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),S=Q&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,fa=Q&&/^(?=.*Chrome).*/i.test(navigator.userAgent),T=Q&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!fa;
function ha(a,c=!1){let b=I(a),f=ia(b.textFormat);return(d,e)=>{d=d.split("\n");let g=d.length;e=e||n.$getRoot();e.clear();for(let u=0;u<g;u++){var m=d[u];a:{var k=d;var t=u,y=b.multilineElement,w=e;for(let {regExpStart:A,regExpEnd:v,replace:C}of y)if(y=k[t].match(A)){var p="object"===typeof v&&"regExp"in v?v.regExp:v,r=v&&"object"===typeof v&&"optional"in v?v.optional:!v,h=t,l=k.length;for(;h<l;){var q=p?k[h].match(p):null;if(q||r&&!(r&&h<l-1))if(q&&t===h&&q.index===y.index)h++;else{p=[];if(q&&t===
h)p.push(k[t].slice(y[0].length,-q[0].length));else for(r=t;r<=h;r++)r===t?(l=k[r].slice(y[0].length),p.push(l)):r===h&&q?(l=k[r].slice(0,-q[0].length),p.push(l)):p.push(k[r]);if(!1!==C(w,null,y,q,p,!0)){k=[!0,h];break a}break}else h++}}k=[!1,t]}let [z,D]=k;if(z)u=D;else{k=m;h=e;q=b.element;t=f;w=b.textMatch;y=n.$createTextNode(k);m=n.$createParagraphNode();m.append(y);h.append(m);for(let {regExp:A,replace:v}of q)if(h=k.match(A))if(y.setTextContent(k.slice(h[0].length)),!1!==v(m,[y],h,!0))break;U(y,
t,w);m.isAttached()&&0<k.length&&(k=m.getPreviousSibling(),n.$isParagraphNode(k)||E.$isQuoteNode(k)||x.$isListNode(k))&&(t=k,x.$isListNode(k)&&(k=k.getLastDescendant(),t=null==k?null:aa.$findMatchingParent(k,x.$isListItemNode)),null!=t&&0<t.getTextContentSize()&&(t.splice(t.getChildrenSize(),0,[n.$createLineBreakNode(),...m.getChildren()]),m.remove()))}}d=e.getChildren();for(let u of d)!c&&K(u)&&1<e.getChildrenSize()&&u.remove();null!==n.$getSelection()&&e.selectStart()}}
function U(a,c,b){var f=a.getTextContent();let d=ja(f,c);if(d){var e,g;if(d[0]===f)var m=a;else{f=d.index||0;let k=f+d[0].length;0===f?[m,e]=a.splitText(k):[g,m,e]=a.splitText(f,k)}m.setTextContent(d[2]);if(a=c.transformersByTag[d[1]])for(let k of a.format)m.hasFormat(k)||m.toggleFormat(k);m.hasFormat("code")||U(m,c,b);g&&U(g,c,b);e&&U(e,c,b)}else ka(a,b)}
function ka(a,c){a:for(;a;){for(let b of c){if(!b.replace||!b.importRegExp)continue;let f=a.getTextContent().match(b.importRegExp);if(!f)continue;let d=f.index||0,e=d+f[0].length,g,m;0===d?[g,a]=a.splitText(e):[,g,m]=a.splitText(d,e);m&&ka(m,c);b.replace(g,f);continue a}break}}
function ja(a,c){var b=a.match(c.openTagsRegExp);if(null==b)return null;for(let e of b){var f=e.replace(/^\s/,"");b=c.fullMatchRegExpByTag[f];if(null!=b&&(b=a.match(b),f=c.transformersByTag[f],null!=b&&null!=f)){if(!1!==f.intraword)return b;var {index:d=0}=b;f=a[d-1];d=a[d+b[0].length];if(!(f&&!J.test(f)||d&&!J.test(d)))return b}}return null}
function ia(a){let c={},b={},f=[];for(let d of a){({tag:a}=d);c[a]=d;let e=a.replace(/(\*|\^|\+)/g,"\\$1");f.push(e);b[a]=R||S||T?new RegExp(`(${e})(?![${e}\\s])(.*?[^${e}\\s])${e}(?!${e})`):new RegExp(`(?<![\\\\${e}])(${e})((\\\\${e})?.*?[^${e}\\s](\\\\${e})?)((?<!\\\\)|(?<=\\\\\\\\))(${e})(?![\\\\${e}])`)}return{fullMatchRegExpByTag:b,openTagsRegExp:new RegExp((R||S||T?"":"(?<![\\\\])")+"("+f.join("|")+")","g"),transformersByTag:c}}var la;
function V(a){let c=new URLSearchParams;c.append("code",a);for(let b=1;b<arguments.length;b++)c.append("v",arguments[b]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${c} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}la=V&&V.__esModule&&Object.prototype.hasOwnProperty.call(V,"default")?V["default"]:V;
function ma(a,c,b){let f=b.length;for(;c>=f;c--){let d=c-f;if(na(a,d,b,0,f)&&" "!==a[d+f])return d}return-1}function na(a,c,b,f,d){for(let e=0;e<d;e++)if(a[c+e]!==b[f+e])return!1;return!0}
let oa=/^(\s*)(\d{1,})\.\s/,pa=/^(\s*)[-*+]\s/,qa=/^(\s*)(?:-\s)?\s?(\[(\s|x)?\])\s/i,W=/^(#{1,6})\s/,ra=/^>\s/,sa=/^[ \t]*```(\w+)?/,ta=/[ \t]*```$/,ua=/^[ \t]*```[^`]+(?:(?:`{1,2}|`{4,})[^`]+)*```(?:[^`]|$)/,va=/^(?:\|)(.+)(?:\|)\s?$/,wa=/^(\| ?:?-*:? ?)+\|\s?$/,xa=a=>(c,b,f)=>{f=a(f);f.append(...b);c.replace(f);f.select(0,0)},X=a=>(c,b,f)=>{var d=c.getPreviousSibling(),e=c.getNextSibling();const g=x.$createListItemNode("check"===a?"x"===f[3]:void 0);x.$isListNode(e)&&e.getListType()===a?(d=e.getFirstChild(),
null!==d?d.insertBefore(g):e.append(g),c.remove()):x.$isListNode(d)&&d.getListType()===a?(d.append(g),c.remove()):(e=x.$createListNode(a,"number"===a?Number(f[2]):void 0),e.append(g),c.replace(e));g.append(...b);g.select(0,0);b=f[1];c=b.match(/\t/g);b=b.match(/ /g);f=0;c&&(f+=c.length);b&&(f+=Math.floor(b.length/4));(c=f)&&g.setIndent(c)},Y=(a,c,b)=>{const f=[];var d=a.getChildren();let e=0;for(const m of d)if(x.$isListItemNode(m)){if(1===m.getChildrenSize()&&(d=m.getFirstChild(),x.$isListNode(d))){f.push(Y(d,
c,b+1));continue}d=" ".repeat(4*b);var g=a.getListType();g="number"===g?`${a.getStart()+e}. `:"check"===g?`- [${m.getChecked()?"x":" "}] `:"- ";f.push(d+g+c(m));e++}return f.join("\n")},ya={dependencies:[E.HeadingNode],export:(a,c)=>{if(!E.$isHeadingNode(a))return null;const b=Number(a.getTag().slice(1));return"#".repeat(b)+" "+c(a)},regExp:W,replace:xa(a=>E.$createHeadingNode("h"+a[1].length)),type:"element"},za={dependencies:[E.QuoteNode],export:(a,c)=>{if(!E.$isQuoteNode(a))return null;a=c(a).split("\n");
c=[];for(const b of a)c.push("> "+b);return c.join("\n")},regExp:ra,replace:(a,c,b,f)=>{if(f&&(b=a.getPreviousSibling(),E.$isQuoteNode(b))){b.splice(b.getChildrenSize(),0,[n.$createLineBreakNode(),...c]);b.select(0,0);a.remove();return}b=E.$createQuoteNode();b.append(...c);a.replace(b);b.select(0,0)},type:"element"},Aa={dependencies:[F.CodeNode],export:a=>{if(!F.$isCodeNode(a))return null;const c=a.getTextContent();return"```"+(a.getLanguage()||"")+(c?"\n"+c:"")+"\n```"},regExpEnd:{optional:!0,regExp:ta},
regExpStart:sa,replace:(a,c,b,f,d,e)=>{if(!c&&d){if(1===d.length)f?(c=F.$createCodeNode(),b=b[1]+d[0]):(c=F.$createCodeNode(b[1]),b=d[0].startsWith(" ")?d[0].slice(1):d[0]);else{c=F.$createCodeNode(b[1]);if(0===d[0].trim().length)for(;0<d.length&&!d[0].length;)d.shift();else d[0]=d[0].startsWith(" ")?d[0].slice(1):d[0];for(;0<d.length&&!d[d.length-1].length;)d.pop();b=d.join("\n")}b=n.$createTextNode(b);c.append(b);a.append(c)}else c&&xa(g=>F.$createCodeNode(g?g[1]:void 0))(a,c,b,e)},type:"multiline-element"},
Ba={dependencies:[x.ListNode,x.ListItemNode],export:(a,c)=>x.$isListNode(a)?Y(a,c,0):null,regExp:pa,replace:X("bullet"),type:"element"},Ca={dependencies:[x.ListNode,x.ListItemNode],export:(a,c)=>x.$isListNode(a)?Y(a,c,0):null,regExp:qa,replace:X("check"),type:"element"},Da={dependencies:[x.ListNode,x.ListItemNode],export:(a,c)=>x.$isListNode(a)?Y(a,c,0):null,regExp:oa,replace:X("number"),type:"element"},Ea={format:["code"],tag:"`",type:"text-format"},Ga={format:["highlight"],tag:"==",type:"text-format"},
Ha={format:["bold","italic"],tag:"***",type:"text-format"},Ia={format:["bold","italic"],intraword:!1,tag:"___",type:"text-format"},Ja={format:["bold"],tag:"**",type:"text-format"},Ka={format:["bold"],intraword:!1,tag:"__",type:"text-format"},La={format:["strikethrough"],tag:"~~",type:"text-format"},Ma={format:["italic"],tag:"*",type:"text-format"},Na={format:["italic"],intraword:!1,tag:"_",type:"text-format"},Oa={dependencies:[G.LinkNode],export:(a,c,b)=>{if(!G.$isLinkNode(a))return null;c=(c=a.getTitle())?
`[${a.getTextContent()}](${a.getURL()} "${c}")`:`[${a.getTextContent()}](${a.getURL()})`;const f=a.getFirstChild();return 1===a.getChildrenSize()&&n.$isTextNode(f)?b(f,c):c},importRegExp:/(?:\[([^[]+)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))/,regExp:/(?:\[([^[]+)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))$/,replace:(a,c)=>{const [,b,f,d]=c;c=G.$createLinkNode(f,{title:d});const e=n.$createTextNode(b);e.setFormat(a.getFormat());c.append(e);a.replace(c)},trigger:")",type:"text-match"};
function Pa(a,c=!1){a=a.split("\n");let b=!1,f=[];for(let d=0;d<a.length;d++){let e=a[d],g=f[f.length-1];ua.test(e)?f.push(e):sa.test(e)||ta.test(e)?(b=!b,f.push(e)):b?f.push(e):""===e||""===g||!g||W.test(g)||W.test(e)||ra.test(e)||oa.test(e)||pa.test(e)||qa.test(e)||va.test(e)||wa.test(e)||!c?f.push(e):f[f.length-1]=g+e}return f.join("\n")}let Qa=[ya,za,Ba,Da],Ra=[Aa],Sa=[Ea,Ha,Ia,Ja,Ka,Ga,Ma,Na,La],Ta=[Oa],Z=[...Qa,...Ra,...Sa,...Ta];
exports.$convertFromMarkdownString=function(a,c=Z,b,f=!1,d=!1){a=f?a:Pa(a,d);return ha(c,f)(a,b)};exports.$convertToMarkdownString=function(a=Z,c,b=!1){return ca(a,b)(c)};exports.BOLD_ITALIC_STAR=Ha;exports.BOLD_ITALIC_UNDERSCORE=Ia;exports.BOLD_STAR=Ja;exports.BOLD_UNDERSCORE=Ka;exports.CHECK_LIST=Ca;exports.CODE=Aa;exports.ELEMENT_TRANSFORMERS=Qa;exports.HEADING=ya;exports.HIGHLIGHT=Ga;exports.INLINE_CODE=Ea;exports.ITALIC_STAR=Ma;exports.ITALIC_UNDERSCORE=Na;exports.LINK=Oa;
exports.MULTILINE_ELEMENT_TRANSFORMERS=Ra;exports.ORDERED_LIST=Da;exports.QUOTE=za;exports.STRIKETHROUGH=La;exports.TEXT_FORMAT_TRANSFORMERS=Sa;exports.TEXT_MATCH_TRANSFORMERS=Ta;exports.TRANSFORMERS=Z;exports.UNORDERED_LIST=Ba;
exports.registerMarkdownShortcuts=function(a,c=Z){let b=I(c),f=H(b.textFormat,({tag:e})=>e[e.length-1]),d=H(b.textMatch,({trigger:e})=>e);for(let e of c)if(c=e.type,"element"===c||"text-match"===c||"multiline-element"===c){c=e.dependencies;for(let g of c)a.hasNode(g)||la(173,g.getType())}return a.registerUpdateListener(({tags:e,dirtyLeaves:g,editorState:m,prevEditorState:k})=>{if(!e.has("collaboration")&&!e.has("historic")&&!a.isComposing()){var t=m.read(n.$getSelection);e=k.read(n.$getSelection);
if(n.$isRangeSelection(e)&&n.$isRangeSelection(t)&&t.isCollapsed()){k=t.anchor.key;var y=t.anchor.offset,w=m._nodeMap.get(k);!n.$isTextNode(w)||!g.has(k)||1!==y&&y>e.anchor.offset+1||a.update(()=>{if(!w.hasFormat("code")){var p=w.getParent();if(null!==p&&!F.$isCodeNode(p)){var r=t.anchor.offset;b:{var h=b.element;var l=p.getParent();if(n.$isRootOrShadowRoot(l)&&p.getFirstChild()===w&&(l=w.getTextContent()," "===l[r-1]))for(let {regExp:v,replace:C}of h)if((h=l.match(v))&&h[0].length===(h[0].endsWith(" ")?
r:r-1)){var q=w.getNextSiblings();let [B,N]=w.splitText(r);B.remove();q=N?[N,...q]:q;if(!1!==C(p,q,h,!1)){l=!0;break b}}l=!1}if(!l){b:{h=b.multilineElement;l=p.getParent();if(n.$isRootOrShadowRoot(l)&&p.getFirstChild()===w&&(l=w.getTextContent()," "===l[r-1]))for(let {regExpStart:v,replace:C,regExpEnd:B}of h)if(!(B&&!("optional"in B)||B&&"optional"in B&&!B.optional)&&(h=l.match(v))&&h[0].length===(h[0].endsWith(" ")?r:r-1)){q=w.getNextSiblings();let [N,Fa]=w.splitText(r);N.remove();q=Fa?[Fa,...q]:
q;if(!1!==C(p,q,h,null,null,!1)){p=!0;break b}}p=!1}if(!p){b:{l=w.getTextContent();p=d[l[r-1]];if(null!=p){r<l.length&&(l=l.slice(0,r));for(z of p)if(z.replace&&z.regExp&&(p=l.match(z.regExp),null!==p)){l=p.index||0;h=l+p[0].length;var u=void 0;0===l?[u]=w.splitText(h):[,u]=w.splitText(l,h);u.selectNext(0,0);z.replace(u,p);var z=!0;break b}}z=!1}if(!z)b:if(h=w.getTextContent(),--r,q=h[r],z=f[q])for(let v of z){var {tag:D}=v;z=D.length;let C=r-z+1;if(!(1<z&&!na(h,C,D,0,z)||" "===h[C-1])&&(u=h[r+1],
!1!==v.intraword||!u||J.test(u))){p=u=w;l=ma(h,C,D);for(var A=p;0>l&&(A=A.getPreviousSibling())&&!n.$isLineBreakNode(A);)n.$isTextNode(A)&&(l=A.getTextContent(),p=A,l=ma(l,l.length,D));if(!(0>l||p===u&&l+z===C||(D=p.getTextContent(),0<l&&D[l-1]===q||(A=D[l-1],!1===v.intraword&&A&&!J.test(A))))){h=u.getTextContent();h=h.slice(0,C)+h.slice(r+1);u.setTextContent(h);h=p===u?h:D;p.setTextContent(h.slice(0,l)+h.slice(l+z));h=n.$getSelection();q=n.$createRangeSelection();n.$setSelection(q);r=r-z*(p===u?
2:1)+1;q.anchor.set(p.__key,l,"text");q.focus.set(u.__key,r,"text");for(let B of v.format)q.hasFormat(B)||q.formatText(B);q.anchor.set(q.focus.key,q.focus.offset,q.focus.type);for(let B of v.format)q.hasFormat(B)&&q.toggleFormat(B);n.$isRangeSelection(h)&&(q.format=h.format);break b}}}}}}}})}}})}
